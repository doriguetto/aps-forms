---
description: Enhanced planning workflow with confidence-driven development, complexity assessment, and quality gates for systematic project execution
globs: **/*
alwaysApply: false
---

### INTERACTION PROTOCOLS ğŸ¤–

1. **Plan Mode (ğŸ¯)**:

   - When I say "plan":
     1. **Assess Plan Complexity**:
        - ğŸŸ¢ Simple (85% confidence threshold): Single component/function
        - ğŸŸ¡ Medium (90% confidence threshold): Feature with multiple files
        - ğŸ”´ Complex (95% confidence threshold): Cross-cutting concerns
        - ğŸŸ£ Epic (98% confidence threshold): Architecture changes
     2. **Create/update [scratchpad.md](mdc:scratchpad.md)** with:
        - Plan complexity level and confidence threshold
        - Weighted confidence breakdown:
          - Requirements clarity (40%)
          - Technical feasibility (30%)
          - Resource availability (20%)
          - Risk assessment (10%)
        - Current phase status
        - Clear questions with examples
        - Effort estimation (S/M/L/XL)
     3. **Context Integration**:
        - **Check project memories** (if `.cursor/memories/` exists):
          - Load relevant memory categories based on work type
          - Reference similar past implementations
          - Apply learned patterns and decision frameworks
        - Check existing project patterns
        - Reference related components/files
        - Validate against project architecture
     4. **Quality Gates Assessment**:
        - â™¿ Accessibility compliance requirements
        - ğŸ”’ Security implications
        - ğŸ§ª Testing strategy needs
     5. Ask targeted questions to increase confidence
     6. Block execution until complexity threshold met
     7. **Planning Completion Checkpoint** ğŸ“:
        - After planning phase concludes and before implementation:
          - Validate if planning yielded memories worth recording:
            âœ“ Research findings (options explored, decisions made)
            âœ“ Human-shared context (preferences, constraints, requirements)
            âœ“ Non-obvious rationale (why chosen approach over alternatives)
            âœ“ Discovered patterns (existing codebase insights)
          - If valuable memories exist, suggest: "Planning revealed valuable insights. Record these memories before implementation? (Save now / Save later / Not valuable)"
          - User chooses: Save now = record immediately, Save later = remind at end, Not valuable = skip

2. **Agent Mode (âš¡)**:

   - Only activate after:
     - âœ… Complexity-appropriate confidence threshold reached
     - âœ… All quality gates reviewed
     - âœ… All questions resolved
   - Implement with:
     - Complete code (NO todos)
     - All required imports
     - Accessibility features baked in
     - TypeScript types
     - Security best practices

3. **Error Handling**:

   - ğŸš© Root Cause Analysis:
     1. Identify error pattern and category
     2. Cross-reference with project patterns
     3. Propose 3 solutions with risk assessment
     4. Implement safest option first
   - ğŸ“¢ User Alerts:
     - "âš ï¸ WARNING: [Issue] â†’ [Impact] â†’ [Fix]" format
     - Emoji status: ğŸ”´ Critical | ğŸŸ  Warning | ğŸ”µ Info | âœ… Resolved

4. **Plan Versioning**:

   - Auto-timestamp plan iterations in scratchpad
   - Track decision rationale
   - Enable rollback to previous versions
   - Document plan evolution

5. **Smart Memory Checkpoints** ğŸ“:
   AI should proactively suggest memory saves at:

   **After Planning Phase**:

   - Prompt: "Planning complete. Record research/decision memories before implementation?"
   - Captures: Options explored, decisions made, rationale, constraints shared

   **Before Context Reset** (when approaching token limit):

   - Prompt: "Context getting full. Save current learnings before reset?"
   - Captures: Work done so far, decisions made, patterns discovered

   **After Major Milestones**:

   - Prompt: "Completed [significant feature/refactor]. Record this memory?"
   - Captures: Architecture decisions, implementation approach, lessons learned

   **After Significant Discovery**:

   - Prompt: "Discovered [important pattern/issue]. Worth recording?"
   - Captures: Nuanced bugs, project patterns, non-obvious solutions

   **Safeguards** (AI validates before prompting):

   ```
   Before suggesting memory save:
   1. âœ“ Content meets "inform future AI sessions" criteria?
   2. âœ“ Substantive enough (not just minor fixes)?
   3. âœ“ Reviewed what happened since last checkpoint?
   4. âœ“ Captured important early decisions if context was reset?

   If ALL checks pass â†’ Prompt user
   If ANY fails â†’ Don't prompt (avoid junk entries)
   ```

   **User Options** (Always provide):

   - **Save Now**: Record memory immediately via save-memories command
   - **Save Later**: Remind at end of session
   - **Not Valuable**: Skip, doesn't meet criteria

### DOCUMENTATION FLOW ğŸ“„

1. **Enhanced Scratchpad Structure**:

   - Plan complexity and thresholds
   - Confidence breakdown by category
   - Quality gates checklist
   - Dependency mapping
   - Risk assessment matrix
   - Implementation timeline

2. **Pre-flight Checks**:
   - Linter compatibility verification
   - Dependency conflict detection
   - Breaking change impact assessment

### CORE PLANNING WORKFLOW ğŸ”„

**Check memories** â†’ **Brainstorm** â†’ **scratchpad.md** â†’ **questions** â†’ **confidence** â†’ **decisions** â†’ **[checkpoint: save planning memories?]** â†’ **implementation** â†’ **[checkpoint: milestone?]** â†’ **iteration** â†’ **[checkpoint: save implementation memories?]**

### MEMORY INTEGRATION ğŸ§ 

**Before Planning**:

- Check if `.cursor/memories/` exists in project
- Load relevant categories based on work type:
  - Auth work â†’ `auth-patterns.md`, `security.md`, `architecture.md`
  - UI work â†’ `ui-components.md`, `css-styling.md`, `architecture.md`
  - Testing â†’ `testing.md`, `typescript-development.md`
- Reference past decisions and patterns in planning
- Apply learned principles to current work

**During Planning**:

- Note any discoveries about existing codebase patterns
- Track human-shared context (preferences, constraints)
- Document non-obvious decisions and rationale

**After Planning** (Checkpoint):

- Validate if valuable memories exist from planning
- Suggest saving if research findings or decisions worth recording

**After Implementation** (Checkpoint):

- Validate if implementation yielded valuable learnings
- Suggest saving if nuanced bugs, patterns, or insights emerged

EXAMPLE USAGE ğŸ’¡
User: "plan how to implement auth"
AI: ğŸ¯ Plan Mode Activated!

1. Checks memories: Loads `auth-patterns.md` (if exists), `architecture.md`
2. Assesses complexity: ğŸ”´ Complex (95% threshold)
3. Creates scratchpad with confidence breakdown
4. Checks existing auth patterns in codebase + memories
5. Reviews quality gates (â™¿ğŸ”’ğŸ§ª)
6. Asks: "Matt, based on AUTH-3 memory, we used JWT before. Use same approach? (ğŸ…°ï¸ Yes - JWT ğŸ…±ï¸ No - OAuth 2.0)"
7. Updates confidence: Requirements 85% â†’ 92%
8. Planning complete: "Research complete. Record decision rationale before implementation? [Save now / Save later / Not valuable]"
9. User chooses "Save later"
10. Proceeds when 95% threshold met â†’ âš¡ Agent Mode!
    ...
    [After implementation]
11. "Completed auth implementation. Discovered CORS nuance with token refresh. Record this memory? [Save now / Save later / Not valuable]"
12. User: "Save now" â†’ Records to auth-patterns.md
